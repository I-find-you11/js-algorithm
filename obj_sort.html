<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name = "viewport" content = "width = device-width, initial-scale = 1.0, maximum-scale = 1.0, user-scalable = 0" />
	<title>币吧</title>
	<script type="text/javascript">
		(function (doc, win, undefined) {
		  var docEl = doc.documentElement,    //获取document元素
		  resizeEvt = 'orientationchange' in win? 'orientationchange' : 'resize',
		  recalc = function () {
		    var clientWidth = docEl.clientWidth;   //获取屏幕宽度
		    if (clientWidth === undefined) return;
		    docEl.style.fontSize = 100 * (clientWidth / 720) + 'px';       //根据当前屏幕的宽度 和 rem值来确定缩放比例
		  };
		  if (doc.addEventListener === undefined) return;
		  win.addEventListener(resizeEvt, recalc, false);
		  doc.addEventListener('DOMContentLoaded', recalc, false)
		})(document, window);
	</script>
	<style type="text/css">
		[v-cloak] {
			display: none;
		}
	</style>
	<link rel="stylesheet" type="text/css" href="css/base.css">
	<link rel="stylesheet" type="text/css" href="css/coin_bar_css.css">
	<script type="text/javascript" src="js/vue.js"></script>
	<script type="text/javascript" src="js/jquery-1.7.js"></script>
</head>
<body>
	<section class='coin_bar' @touchmove = 'touch_move($event)' @touchstart = 'touch_start($event)' @touchend = 'touch_end($event)'>
		<main>
			<section class='coin_scroll'>
				<section class='coin_tab'>
					<ul>
						<li v-for = '(tab_item,index) in tab_dist' 
							:key='index'
							@click = 'coin_sort(tab_item.sort)'
						>
							{{tab_item.name}}
						</li>
					</ul>
				</section>
				<section class='coin_dist'>
					<ul>
						<li 
							v-for = '(coin_item,index) in coin_dist'
							:key = 'index'
						>
							<section class='coin_infor'>
								<span class='dist_index'>{{index + 1}}</span>
								<img :src="'https://s2.coinmarketcap.com/static/img/coins/64x64/' + coin_item.id + '.png'">
								<span class='coin_name'>{{coin_item.symbol}}</span>
							</section>
							<section class='coin_market_value'>
								<span>${{coin_item.quotes.USD.market_cap}}</span>
							</section>
							<section class='coin_price'>
								<span>${{coin_item.quotes.USD.price}}</span>
							</section>
							<section class='trading_volume'>
								<span>{{coin_item.quotes.USD.volume_24h}}</span>
							</section>
							<section class="coin_circulating_supply">
								<span>{{coin_item.total_supply}}</span>
							</section>
							<section class='coin_change_amount'>
								<span>{{(coin_item.quotes.USD.percent_change_24h > 0? '+' : '') + coin_item.quotes.USD.percent_change_24h}}</span>
							</section>
						</li>
					</ul>
				</section>
			</section>
		</main>
	</section>
</body>
<script type="text/javascript">
	new Vue({
		el : '.coin_bar',
		data : {
			user_header : {
				user_img  : 'img/user_img.png',
				user_name : '万能的小裴',
				name      : '币吧',
			},
			tab_dist : [
				{
					name : '名称',
					sort : ''
				},
				{
					name : '市值',
					sort : 'quotes.USD.market_cap'
				},
				{
					name : '价格',
					sort : 'quotes.USD.price'
				},
				{
					name : '交易量(24小时)',
					sort : 'quotes.USD.volume_24h'
				},
				{
					name : '流通供给量',
					sort : 'total_supply'
				},
				{
					name : '变化量',
					sort : 'quotes.USD.percent_change_24h'
				}
			],
			coin_dist : [
				
			],
			coin_dist_start : 0,
			touch_move_data : {
				startY : 0,
				moveY : '',
				touching : false
			},
		},
		methods : {
			coin_data_ajax : function () {
				var this_ = this;
				$.ajax({
					url : 'https://api.coinmarketcap.com/v2/ticker/?limit=10&start= ' + this_.coin_dist_start + '&sort=id&structure=array',
					post : 'GET',
					success : function (data) {
						console.log(data.data)
						this_.coin_dist = this_.coin_dist.concat(data.data);
					}
				})
			},
			coin_sort : function (stor_type){
				if(!stor_type) {
					return false;
				}
				var sort_arr =[];
				var new_coin_dist = [];
				for( i in this.coin_dist) {
					var aaaa = 'this.coin_dist[' + i + '].' + stor_type;
					sort_arr.push(eval(aaaa));
				}
				var new_sort_arr = sort_arr.sort(this.sortNumber);
				console.log(new_sort_arr);
				for( l in new_sort_arr){
					for( t in this.coin_dist) {
						var aaaa = 'this.coin_dist[' + t + '].' + stor_type;
						var bbbb = eval(aaaa);
						if(new_sort_arr[l] === bbbb) {
							new_coin_dist[l] = this.coin_dist[t];
							this.coin_dist.splice(t,1);
							break;
						} 
					}
				}
				console.log(new_coin_dist);
				this.coin_dist = new_coin_dist;
			},
			sortNumber : function (a,b){
				return b - a
			},
			touch_start : function (e) {
				this.touch_move_data.startY = e.targetTouches[0].pageY;
			},
			touch_move : function (e) {
				this.touch_move_data.moveY = e.targetTouches[0].pageY;
			},
			touch_end : function () {
				if($(document).scrollTop() + $(window).height() == $(document).height()) {
					this.touching = true;
				}
				if (this.touching && this.touch_move_data.startY - this.touch_move_data.moveY > 40) {
					this.coin_dist_start += 10;
					this.coin_data_ajax();
					this.touching = false;
				}

			}

		},
		created : function () {
			this.coin_data_ajax();
		}
	})
</script>
</html>